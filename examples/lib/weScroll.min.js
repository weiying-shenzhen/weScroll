!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.WeScroll=i()}(this,function(){"use strict";function t(t,i,e,o){t.addEventListener(i,e,!!o)}function i(t,i,e,o){t.removeEventListener(i,e,!!o)}function e(t,i){var e=document.createEvent("Event");e.initEvent(i,!0,!0),t=t.changedTouches[0]||t,e.pageX=t.pageX,e.pageY=t.pageY,t.target.dispatchEvent(e)}var o=void 0;o="function"!=typeof Object.assign?function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),e=1;e<arguments.length;e++){var o=arguments[e];if(void 0!==o&&null!==o)for(var s in o)o.hasOwnProperty(s)&&(i[s]=o[s])}return i}:Object.assign;var s=o,n="ontouchstart"in window,r=!(!window.PointerEvent&&!window.MSPointerEvent),h={quadratic:function(t){return t*(2-t)},circular:function(t){return Math.sqrt(1- --t*t)},back:function(t){return(t-=1)*t*(5*t+4)+1},bounce:function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},elastic:function(t){return 0===t?0:1===t?1:.4*Math.pow(2,-10*t)*Math.sin((t-.055)*(2*Math.PI)/.22)+1}},a=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},c=function(){function t(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(i,e,o){return e&&t(i.prototype,e),o&&t(i,o),i}}(),u=function(){function t(t,i){var e=[],o=!0,s=!1,n=void 0;try{for(var r,h=t[Symbol.iterator]();!(o=(r=h.next()).done)&&(e.push(r.value),!i||e.length!==i);o=!0);}catch(t){s=!0,n=t}finally{try{!o&&h.return&&h.return()}finally{if(s)throw n}}return e}return function(i,e){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return t(i,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function t(){a(this,t),this._events=[]}return c(t,[{key:"on",value:function(t,i){var e=this._events[t];e||(e=[]),e.push(i),this._events[t]=e}},{key:"off",value:function(t,i){var e=this._events[t];if(e){var o=e.indexOf(i);o>-1&&e.splice(o,1)}}},{key:"trigger",value:function(t){var i=this._events[t];if(i&&i.length)for(var e=0;e<i.length;e++)i[e].apply(this,[].slice.call(arguments,1))}}]),t}(),p=function(t){for(var i=-t.offsetLeft,e=-t.offsetTop;t=t.offsetParent;)i-=t.offsetLeft,e-=t.offsetTop;return{left:i,top:e}},d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},f={zoomMin:1,zoomMax:4,startZoom:1,disablePointer:!r,disableTouch:r||!n,disableMouse:r||n,startX:0,startY:0,directionLockThreshold:5,margin:0,bounce:!0,bounceTime:480,duration:300,preventDefault:!0,bindToWrapper:!0};return function(){function o(t,i){a(this,o),this.wrapper="string"==typeof t?document.querySelector(t):t,this.options=s({},f,i),this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault;var e=this.options.margin;this.options.marginTop=this.options.marginTop||e,this.options.marginBottom=this.options.marginBottom||e,this.options.marginLeft=this.options.marginLeft||e,this.options.marginRight=this.options.marginRight||e,!0===this.options.tap&&(this.options.tap="tap"),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this.scale=Math.min(Math.max(this.options.startZoom,this.options.zoomMin),this.options.zoomMax),this._init(),this.refresh(),this._scrollTo(this.options.startX,this.options.startY),this.enable(),this._ticking=!1}return c(o,[{key:"_init",value:function(){this.observer=new l,this._initEvents()}},{key:"destroy",value:function(){this._initEvents(!0),clearTimeout(this.resizeTimeout),this.resizeTimeout=null,this.observer.trigger("destroy")}},{key:"_start",value:function(t){if(!this._ticking&&this.enabled){this.options.preventDefault&&t.preventDefault();var i=t.touches?t.touches[0]:t;this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this.startTime=Date.now(),this.isAnimating&&(this.isAnimating=!1,this.observer.trigger("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=i.pageX,this.pointY=i.pageY,this.observer.trigger("beforeScrollStart")}}},{key:"_move",value:function(t){if(this.enabled&&!this._ticking){this.options.preventDefault&&t.preventDefault();var i=t.touches?t.touches[0]:t,e=i.pageX-this.pointX,o=i.pageY-this.pointY,s=Date.now(),n=void 0,r=void 0,h=void 0,a=void 0;this.pointX=i.pageX,this.pointY=i.pageY,this.distX+=e,this.distY+=o,h=Math.abs(this.distX),a=Math.abs(this.distY),s-this.endTime>300&&h<10&&a<10||(this.directionLocked||(h>a+this.options.directionLockThreshold?this.directionLocked="h":a>=h+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"===this.directionLocked?o=0:"v"===this.directionLocked&&(e=0),n=this.x+e,r=this.y+o,(n>0||n<this.maxScrollX)&&(n=this.options.bounce?this.x+e/3:n>0?0:this.maxScrollX),(r>0||r<this.maxScrollY)&&(r=this.options.bounce?this.y+o/3:r>0?0:this.maxScrollY),this.directionX=e>0?-1:e<0?1:0,this.directionY=o>0?-1:o<0?1:0,this.moved||this.observer.trigger("scrollStart"),s-this.startTime>300&&(this.startTime=s,this.startX=this.x,this.startY=this.y),this._render(n,r),this.moved=!0)}}},{key:"_end",value:function(t){if(this.enabled){this.options.preventDefault&&t.preventDefault();var i=Math.round(this.x),o=Math.round(this.y),s="";if(this.endTime=Date.now(),!this.resetPosition(this.options.bounceTime))return this._scrollTo(i,o),this.moved?i!==this.x||o!==this.y?((i>this.options.marginLeft||i<this.maxScrollX||o>this.options.marginTop||o<this.maxScrollY)&&(s=h.quadratic),void this._scrollTo(i,o,0,s)):void this.observer.trigger("scrollEnd"):(this.options.tap&&!this.scaled&&(!this.zoomEndTime||this.zoomEndTime&&this.zoomEndTime+200<Date.now())&&e(t,this.options.tap),void this.observer.trigger("scrollCancel"))}}},{key:"_resize",value:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){t.refresh()},this.options.resizePolling)}},{key:"_adjustPosition",value:function(t,i){var e=t,o=i;return e>this.options.marginLeft?e=this.options.marginLeft:e<this.maxScrollX&&(e=this.maxScrollX),o>this.options.marginTop?o=this.options.marginTop:o<this.maxScrollY&&(o=this.maxScrollY),[e,o]}},{key:"resetPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=this._adjustPosition(this.x,this.y),e=u(i,2),o=e[0],s=e[1];return(o!==this.x||s!==this.y)&&(this._scrollTo(o,s,t,h.circular),!0)}},{key:"disable",value:function(){this.enabled=!1}},{key:"enable",value:function(){this.enabled=!0}},{key:"refresh",value:function(){this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.wrapperOffset=p(this.wrapper),this._refreshScroller(),this.observer.trigger("refresh")}},{key:"_refreshScroller",value:function(){this.scrollerWidth=Math.round(this.options.contentWidth*this.scale),this.scrollerHeight=Math.round(this.options.contentHeight*this.scale),this.maxScrollX=this.wrapperWidth-this.scrollerWidth-this.options.marginRight,this.maxScrollY=Math.min(this.options.marginTop,this.wrapperHeight-this.scrollerHeight-this.options.marginBottom),this.endTime=0,this.directionX=0,this.directionY=0}},{key:"_render",value:function(t,i){if(!this._ticking){var e=function(){this.options.render(t,i,this.scale),this.x=t,this.y=i,this._ticking=!1};if(!this._ticking){var o=e.bind(this);d(o),this._ticking=!0}}}},{key:"_zoomStart",value:function(t){var i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),e=Math.abs(t.touches[0].pageY-t.touches[1].pageY);this.touchesDistanceStart=Math.sqrt(i*i+e*e),this.startScale=this.scale,this.originX=Math.abs(t.touches[0].pageX+t.touches[1].pageX)/2+this.wrapperOffset.left-this.x,this.originY=Math.abs(t.touches[0].pageY+t.touches[1].pageY)/2+this.wrapperOffset.top-this.y,this.observer.trigger("zoomStart")}},{key:"_zoom",value:function(t){if(this.enabled){this.options.preventDefault&&t.preventDefault();var i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),e=Math.abs(t.touches[0].pageY-t.touches[1].pageY),o=Math.sqrt(i*i+e*e),s=1/this.touchesDistanceStart*o*this.startScale,n=void 0,r=void 0,h=void 0;this.scaled=!0,s<this.options.zoomMin?s=.5*this.options.zoomMin*Math.pow(2,s/this.options.zoomMin):s>this.options.zoomMax&&(s=2*this.options.zoomMax*Math.pow(.5,this.options.zoomMax/s)),n=s/this.startScale,r=this.originX-this.originX*n+this.startX,h=this.originY-this.originY*n+this.startY,this.scale=s,this._scrollTo(r,h,0)}}},{key:"_zoomEnd",value:function(t){if(this.enabled){this.options.preventDefault&&t.preventDefault(),this.scale>this.options.zoomMax?this.scale=this.options.zoomMax:this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin),this._refreshScroller();var i=this.scale/this.startScale,e=this.originX-this.originX*i+this.startX,o=this.originY-this.originY*i+this.startY,s=this._adjustPosition(e,o),n=u(s,2),r=n[0],h=n[1];this.x===r&&this.y===h||this._scrollTo(r,h,this.options.bounceTime),this.scaled=!1,this.zoomEndTime=Date.now(),this.observer.trigger("zoomEnd")}}},{key:"_getDestinationPosition",value:function(t,i){var e=void 0===t?this.scrollerWidth/2:t*this.scale,o=void 0===i?this.scrollerHeight/2:i*this.scale;e=this.wrapperWidth/2-e,o=this.wrapperHeight/2-o;var s=this._adjustPosition(e,o),n=u(s,2);return{x:n[0],y:n[1]}}},{key:"_animate",value:function(t,i,e,o){function s(){var u=Date.now(),l=void 0,p=void 0,f=void 0;if(u>=c)return n.isAnimating=!1,void n._render(t,i);u=(u-a)/e,f=o(u),l=(t-r)*f+r,p=(i-h)*f+h,n._render(l,p),n.isAnimating&&d(s)}var n=this,r=this.x,h=this.y,a=Date.now(),c=a+e;this.isAnimating=!0,s()}},{key:"_scrollTo",value:function(t,i,e,o){o=o||h.circular,e?this._animate(t,i,e,o):(this._render(t,i),this.observer.trigger("scrollEnd"))}},{key:"scrollTo",value:function(t,i,e,o){e=void 0===e?this.options.duration:e,o=o||h.circular,t=-t*this.scale+this.wrapperWidth/2,i=-i*this.scale+this.wrapperHeight/2;var s=this._adjustPosition(t,i),n=u(s,2),r=n[0],a=n[1];this._scrollTo(r,a,e,o)}},{key:"zoom",value:function(t,i,e,o){function s(){var h=Date.now(),l=void 0,p=void 0,f=void 0,v=void 0;if(h>=c)return n.isAnimating=!1,n.scale=t,n._refreshScroller(),f=n._getDestinationPosition(i,e),void n._render(f.x,f.y);h=(h-a)/o,v=u(h),p=(t-r)*v+r,n.scale=p,n._refreshScroller(),l=n._getDestinationPosition(i,e),n._render(l.x,l.y),n.isAnimating&&d(s)}if(t<this.options.zoomMin?t=this.options.zoomMin:t>this.options.zoomMax&&(t=this.options.zoomMax),t!==this.scale){o=void 0===o?300:o;var n=this,r=n.scale,a=Date.now(),c=a+o,u=h.circular;this.isAnimating=!0,s()}}},{key:"on",value:function(t,i){this.observer.on(t,i)}},{key:"off",value:function(t,i){this.observer.off(t,i)}},{key:"_initEvents",value:function(e){var o=e?i:t,s=this.options.bindToWrapper?this.wrapper:window,r=this._handleEvent.bind(this);if(o(window,"resize",r),!this.options.disableMouse){o(this.wrapper,"mousedown",r);["mousemove","mousecancel","mouseup"].forEach(function(t){o(s,t,r)})}if(n&&!this.options.disableTouch){o(this.wrapper,"touchstart",r);["touchmove","touchcancel","touchend"].forEach(function(t){o(s,t,r)})}}},{key:"_handleEvent",value:function(t){switch(t.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(t),this.options.zoom&&t.touches&&t.touches.length>1&&this._zoomStart(t);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":if(this.options.zoom&&t.touches&&t.touches[1])return void this._zoom(t);this._move(t);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":if(this.scaled)return void this._zoomEnd(t);this._end(t);break;case"orientationchange":case"resize":this._resize()}}}]),o}()});
